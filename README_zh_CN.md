[English](https://github.com/shenjinglei/siyuan-plugin-graph-enhance/blob/main/README.md)

# 关系图增强

## 开始

启用本插件后，会在右上方添加一个侧边栏按钮，打开侧边栏后点击上方的功能按钮，会在侧边栏中绘制相应的关系图。

例如，在笔记`a`中引用了笔记`b`、`c`和`d`，思源笔记的关系图如左图所示，本插件绘制的关系图如右图所示。

![pic1](https://z1.ax1x.com/2023/10/20/piFpacQ.png) ![pic2](https://z1.ax1x.com/2023/10/20/piFpN9S.png)

本插件更突出层次关系。

## 更新日志

- v0.4.2
  - 增加显示、隐藏 Dailynote 按钮
- v0.4.1
  - 新功能：路径图
    - 绘制两点间路径
    - 如何选择起点终点
      - 当开启自动跟随时，依次点击`起点`,`终点`后，点击`路径图`按钮，即可绘制。
      - 当未开启自动跟随时，依次点击`起点`,`路径图`,`终点`,`路径图`，即可绘制。
- v0.4.0
  - 图分割改动，现在无需在插件设置中配置，只需要在笔记文档中引用特定文档即可，具体见功能说明。
  - 起点图，终点图，长尾图功能已迁移至`笔记旭日图`插件中。
- v0.3.6
  - 增加了连接线的颜色
    - 颜色连接线从起始点开始，直到该分支的尽头，类似思维导图。
      ![](https://z1.ax1x.com/2023/12/07/pig5hc9.png)
- v0.3.5
  - [#10](https://github.com/shenjinglei/siyuan-plugin-graph-enhance/issues/10) 更新侧栏图标。
  - 调整 label 宽度。
- v0.3.4
  - 增加了与起始点处于同一水平的节点的颜色。
- v0.3.3
  - 新功能：长尾图
    - 展示那些链接数少的节点，那些散落在角落里的笔记。
    - 连接数阈值在设置中设置，链接数的上限和下限都可以设置。
  - 新增设置：排除节点
  - 边分割的起始点只能看到相邻节点
- v0.3.2
  - 优化了关系图自动跟随当前文档功能，思源版本需要 2.10.13 以上
- v0.3.1
  - 最大节点数限制将作用于全部的绘制图
  - dailynote 将默认作为分割点
- v0.3.0
  - 新功能：图分割
- v0.2.0
  - 新功能：起始图
  - 新功能：终点图
  - 新功能：邻近图
  - 新功能：纵横图
- v0.1.0
  - 新功能：纵向图
  - 新功能：横向图
  - 新功能：全局图

详细更新日志请查看[CHANGELOG](./CHANGELOG.md)

## 功能说明

### 基本图

对于上文的关系图，可以分类成以下 3 种基本形式：展示跨层次间关系的纵向图、展示同层次间关系的横向图，和全局关系图。

![pic3](https://z1.ax1x.com/2023/10/20/piFScyd.png)

- 绘制过程由一个起始点开始，即当前文档，在图中用红色标记；其他链接到的点用蓝色标记。
- 设置中可以调整布局方向、布局方式、节点个数限制等。

### 邻近图

- 从起始点开始，经过特定次链接可达的点所绘制的图。
- 设置中可以调整该次数。

### 纵横图

- 纵向图和横向图合并后的图。

### 图分割

有时候当绘制图的节点过多，我们希望将图按某些条件分割时，可以按以下方式操作。

#### 点分割

假设有如下关系图，起始点（当前文档）为 `b`，那么 `b` 的位置就是 `0`，`b` 正链指向的文档 `c`、`c1`、`c2` 是 1，反链指向的文档 `a` 是-1。

![](https://s11.ax1x.com/2023/12/13/pif626I.png)

如果我们想在 `c`、`c1`、`c2` 点分割图形，只要在文档 `b` 中，引用`ge-cv1`即可。

![](https://s11.ax1x.com/2023/12/13/pifcd3j.png)

类似地，我们在文档 `a` 中引用`ge-cv2`也能达到同样效果。

分割后，从`b`起始的图如下，将不再绘制`c`,`c1`,`c2`之后的节点。

![](https://s11.ax1x.com/2023/12/13/pifcRC4.png)

从`d`起始的图也不再绘制`c`,`c1`,`c2`之前的节点，即关系图已被分割。

![](https://s11.ax1x.com/2023/12/13/pifchvR.png)

而从`c`起始的图会同时绘制两个部分。

![](https://s11.ax1x.com/2023/12/13/pifcHUO.png)

#### 边分割

假设有如下关系图，起始点（当前文档）为 `b`，那么 `b` 正链 `b-c`、`b-c1`、`b-c2` 是 1，反链 `b-a` 是-1。其次类推。

![](https://s11.ax1x.com/2023/12/13/pifgFPg.png)

当我们想分割`c-d`,`c1-d`,`c2-d`的边时，我们可以在文档 `b` 中引用`ge-ce2`（也可以在文档 `a` 中引用`ge-ce3`）。

![](https://s11.ax1x.com/2023/12/13/pifgcLt.png)

分割后，从`b`起始的图如下，`c-d`,`c1-d`,`c2-d`的边不会绘制了。

![](https://s11.ax1x.com/2023/12/13/pifg2eP.png)

从`e`起始的图如下，`c-d`,`c1-d`,`c2-d`的边也不会绘制了。

![](https://s11.ax1x.com/2023/12/13/pifISNq.png)

从`c`起始的图，将会绘制`c-d`的边。

![](https://s11.ax1x.com/2023/12/13/pifICCV.png)

- 起始于`分割点`和`分割边`上的图可以跨越分割，同时看到两边的图。

### 其他

- 点击节点可以跳转至对应笔记。
- 设置中可以设置“跟随”当前文档，让笔记与图形联动更流畅。
- 复杂的设置建议另行保存，以防意外丢失。

### 一些实践

- [笔记可视化 - 关系图增强插件的使用](https://ld246.com/article/1696579047798)
- [关于关系图增强插件](https://ld246.com/article/1702042778713)

## 未来计划

- [ ] 布局优化
- [x] 颜色区分

## 反馈

如果有问题、建议等可通过[github issue](https://github.com/shenjinglei/siyuan-plugin-graph-enhance/issues)反馈。

若无法访问也可以通过[gitee issue](https://gitee.com/shenjinglei/siyuan-plugin-graph-enhance/issues)反馈。

## 赞助

[胖头鱼](https://afdian.net/a/shenjinglei)

## 感谢

- 本项目使用了[Dagre](https://github.com/dagrejs/dagre)进行有向图布局计算。
- 本项目使用了[Apache ECharts](https://echarts.apache.org/en/index.html)绘制图形。
- 本项目使用了[Color.js](https://github.com/color-js/color.js)进行颜色混合计算。
- 本项目为[siyuan](https://github.com/siyuan-note/siyuan)插件，已在思源集市上架。
