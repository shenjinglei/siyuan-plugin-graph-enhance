[English](https://github.com/shenjinglei/siyuan-plugin-graph-enhance/blob/main/README.md)

# 关系图增强

## 开始

启用本插件后，会在右上方添加一个侧边栏按钮，打开侧边栏后点击上方的功能按钮，会在侧边栏中绘制相应的关系图。

例如，在笔记【a】中引用了笔记【b】、【c】和【d】，思源笔记的关系图如左图所示，本插件绘制的关系图如右图所示。

![pic1](https://z1.ax1x.com/2023/10/20/piFpacQ.png) ![pic2](https://z1.ax1x.com/2023/10/20/piFpN9S.png)

本插件更突出层次关系。

## 更新日志

- v0.3.3
  - 新功能：长尾图
    - 展示那些链接数少的节点，那些散落在角落里的笔记。
    - 连接数阈值在设置中设置，链接数的上限和下限都可以设置。
  - 新增设置：排除节点
  - 边分割的起始点只能看到相邻节点
- v0.3.2
  - 优化了关系图自动跟随当前文档功能，思源版本需要 2.10.13 以上
- v0.3.1
  - 最大节点数限制将作用于全部的绘制图
  - dailynote 将默认作为分割点
- v0.3.0
  - 新功能：图分割
- v0.2.0
  - 新功能：起始图
  - 新功能：终点图
  - 新功能：邻近图
  - 新功能：纵横图
- v0.1.0
  - 新功能：纵向图
  - 新功能：横向图
  - 新功能：全局图

详细更新日志请查看[CHANGELOG](./CHANGELOG.md)

## 功能说明

### 基本图

对于上文的关系图，可以分类成以下 3 种基本形式：展示跨层次间关系的纵向图、展示同层次间关系的横向图，和全局关系图。

![pic3](https://z1.ax1x.com/2023/10/20/piFScyd.png)

- 绘制过程由一个起始点开始，即当前文档，在图中用红色标记；其他链接到的点用蓝色标记。
- 设置中可以调整布局方向、布局方式、节点个数限制等。

### 起点/终点图

起点/终点图会从起点（即没有被其他笔记引用）或终点（即没有引用其他笔记）开始绘制旭日图。

假设起点图如下图所示，说明起始笔记有`A`和`B`两篇，其中`A`有子笔记`a1`、`a2`，其下分别还有子笔记`a11`、`a21`

![](https://z1.ax1x.com/2023/10/27/pieiS2R.png)

- 不足三层的块会被合并入“其他”块中。
- 如果绘制后的图太密集或太稀疏，可以调整设置中的阈值。调高阈值可以减少显示的块数量。

### 邻近图

- 从起始点开始，经过特定次链接可达的点所绘制的图。
- 设置中可以调整该次数。

### 纵横图

- 纵向图和横向图合并后的图。也是关系图增强的默认绘制方式。

### 图分割

有时候当绘制图的节点过多，我们希望将图按某些条件分割时，可以按以下方式操作。

首先，如下所示生成的图。假设以“b”为起始点，正向链接的节点为`1`，中间的链接线为`0.5`，再远些的为`1.5`,`2`以此类推。反向链接指向的为负数如`-0.5`,`-1`。

![](https://z1.ax1x.com/2023/10/27/pie9fL8.png)

分割时我们需要指定`起始点`和`分割位置`。

#### 点分割

当我们想分割`c`,`c1`,`c2`点时，我们可以指定以`b,1`分割（也可以用`a,2`分割）。

分割后，从`b`起始的图如下，将不再绘制`c`,`c1`,`c2`之后的节点。

![](https://z1.ax1x.com/2023/10/27/pieCVeO.png)

从`d`起始的图也不再绘制`c`,`c1`,`c2`之前的节点。

![](https://z1.ax1x.com/2023/10/27/pieCZwD.png)

而从`c`起始的图会将两部分的都绘制。

![](https://z1.ax1x.com/2023/10/27/pieCllt.png)

#### 边分割

当我们想分割`c-d`,`c1-d`,`c2-d`的边时，我们可以指定以`b,1.5`分割（也可以用`a,2.5`分割）。

分割后，从`b`起始的图如下，`c-d`,`c1-d`,`c2-d`的边不会绘制了。

![](https://z1.ax1x.com/2023/10/27/pieCT0O.png)

从`e`起始的图如下，`c-d`,`c1-d`,`c2-d`的边也不会绘制了。

![](https://z1.ax1x.com/2023/10/27/pieCLhd.png)

从`c`起始的图，将会绘制`c-d`的边。

![](https://z1.ax1x.com/2023/10/27/pieP9HS.png)

- 在`插件设置`的`图分割配置`中，可以指定分割，每个分割字符串一行。

  ![](https://z1.ax1x.com/2023/10/27/piePMEF.png)

- 可以使用正则表达式指定起始点

- 起始于`分割点`和`分割边`上的图可以跨越分割，同时看到两边的图。

### 其他

- 点击节点可以跳转至对应笔记，可以当做另一种笔记目录。
- 设置中可以设置“跟随”当前文档，让笔记与图形联动更流畅。
- 复杂的设置建议另行保存，以防意外丢失。

### 一些实践

- [笔记可视化 - 关系图增强插件的使用](https://ld246.com/article/1696579047798)

## 未来计划

- [ ] 布局优化
- [ ] 颜色区分

## 反馈

如果有问题、建议等可通过[github issue](https://github.com/shenjinglei/siyuan-plugin-graph-enhance/issues)反馈。

若无法访问也可以通过[gitee issue](https://gitee.com/shenjinglei/siyuan-plugin-graph-enhance/issues)反馈。

## 赞助

[胖头鱼](https://afdian.net/a/shenjinglei)

## 感谢

- 本插件使用了[Dagre](https://github.com/dagrejs/dagre)进行有向图布局计算
- 本插件使用了[Apache ECharts](https://echarts.apache.org/en/index.html)绘制图形
- 本项目为[siyuan](https://github.com/siyuan-note/siyuan)插件，已在思源集市上架。
